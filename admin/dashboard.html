<title>Admin Dashboard - LearnHub</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<!-- Design System -->
<link rel="stylesheet" href="../assets/css/design-system.css">
<link rel="stylesheet" href="../assets/css/components.css">
<link rel="stylesheet" href="../assets/css/admin.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

    <!-- Top Navbar -->
    <nav class="admin-navbar" role="navigation" aria-label="Admin navigation">
        <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle sidebar">
            <i class="bi bi-list" aria-hidden="true"></i>
        </button>
        <a class="navbar-brand" href="dashboard.html">
            <i class="bi bi-mortarboard-fill" aria-hidden="true"></i>
            <span>LearnHub Admin</span>
        </a>
        <div class="admin-navbar-end">
            <button class="btn btn-link text-dark me-2" id="adminThemeToggle" aria-label="Toggle dark mode"
                title="Toggle theme">
                <i class="bi bi-moon-fill"></i>
            </button>
            <div class="admin-user-info">
                <i class="bi bi-person-circle" aria-hidden="true"></i>
                <span id="adminName">Administrator</span>
            </div>
            <button class="admin-logout-btn" onclick="logout()">
                <i class="bi bi-box-arrow-right me-1" aria-hidden="true"></i> Logout
            </button>
        </div>
    </nav>

    <!-- Sidebar -->
    <aside class="admin-sidebar" id="adminSidebar">
        <nav class="admin-sidebar-nav">
            <a href="dashboard.html" class="admin-nav-item active">
                <i class="bi bi-speedometer2"></i>
                <span>Dashboard</span>
            </a>
            <a href="courses.html" class="admin-nav-item">
                <i class="bi bi-book"></i>
                <span>Courses</span>
            </a>
            <a href="course-content.html" class="admin-nav-item">
                <i class="bi bi-collection"></i>
                <span>Course Content</span>
            </a>
            <a href="requests.html" class="admin-nav-item">
                <i class="bi bi-envelope"></i>
                <span>Requests</span>
            </a>
            <a href="students.html" class="admin-nav-item">
                <i class="bi bi-people"></i>
                <span>Students</span>
            </a>
            <div style="margin-top: auto; padding-top: 2rem; border-top: 1px solid rgba(226, 232, 240, 0.1);">
                <a href="settings.html" class="admin-nav-item">
                    <i class="bi bi-gear"></i>
                    <span>Settings</span>
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-main" id="main-content">
        <div class="admin-page-header">
            <h1 class="admin-page-title">Dashboard Overview</h1>
            <p class="text-muted mb-0">Welcome back! Here's what's happening today.</p>
        </div>

        <!-- Stats Cards -->
        <div class="row g-4 mb-4">
            <div class="col-md-4">
                <div class="admin-stat-card">
                    <div class="admin-stat-content">
                        <div class="admin-stat-icon primary">
                            <i class="bi bi-people-fill"></i>
                        </div>
                        <div class="admin-stat-details">
                            <h6>Total Students</h6>
                            <p class="stat-value" id="totalStudents">-</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="admin-stat-card">
                    <div class="admin-stat-content">
                        <div class="admin-stat-icon success">
                            <i class="bi bi-book-fill"></i>
                        </div>
                        <div class="admin-stat-details">
                            <h6>Active Courses</h6>
                            <p class="stat-value" id="activeCourses">-</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="admin-stat-card">
                    <div class="admin-stat-content">
                        <div class="admin-stat-icon warning">
                            <i class="bi bi-clock-fill"></i>
                        </div>
                        <div class="admin-stat-details">
                            <h6>Pending Requests</h6>
                            <p class="stat-value" id="pendingRequests">-</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="admin-table-container">
            <div class="p-4">
                <h5 class="mb-3" style="font-weight: 700; color: #1e293b;">Quick Actions</h5>
                <div class="d-flex gap-3 flex-wrap">
                    <a href="courses.html" class="btn btn-admin-primary">
                        <i class="bi bi-plus-lg me-2"></i>Add New Course
                    </a>
                    <a href="requests.html" class="btn btn-admin-secondary">
                        <i class="bi bi-envelope me-2"></i>View Requests
                    </a>
                    <a href="students.html" class="btn btn-admin-secondary">
                        <i class="bi bi-people me-2"></i>Manage Students
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script src="../assets/js/ui-utils.js"></script>
    <script src="../assets/js/supabase-client.js"></script>
    <script>
        // Check Auth
        const adminUser = JSON.parse(localStorage.getItem('adminUser'));
        if (!adminUser || adminUser.role !== 'admin') {
            window.location.href = 'login.html';
        }

        // Display admin name
        if (adminUser && adminUser.full_name) {
            document.getElementById('adminName').textContent = adminUser.full_name;
        }

        // Setup theme toggle
        const themeToggle = document.getElementById('adminThemeToggle');
        const updateThemeIcon = () => {
            const theme = document.documentElement.getAttribute('data-theme');
            const icon = themeToggle.querySelector('i');
            icon.className = theme === 'dark' ? 'bi bi-sun-fill' : 'bi bi-moon-fill';
        };
        updateThemeIcon();
        themeToggle.addEventListener('click', () => {
            window.themeManager.toggle();
            updateThemeIcon();
        });

        function logout() {
            localStorage.removeItem('adminUser');
            window.location.href = 'login.html';
        }

        function toggleSidebar() {
            document.getElementById('adminSidebar').classList.toggle('show');
        }

        // Load Stats
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Count Students
                const { count: studentCount, error: studError } = await window.sb
                    .from('users')
                    .select('*', { count: 'exact', head: true })
                    .eq('role', 'student');

                if (studError) throw studError;
                document.getElementById('totalStudents').innerText = studentCount || 0;

                // Count Courses
                const { count: courseCount, error: courseError } = await window.sb
                    .from('courses')
                    .select('*', { count: 'exact', head: true });

                if (courseError) throw courseError;
                document.getElementById('activeCourses').innerText = courseCount || 0;

                // Count Requests
                const { count: requestCount, error: reqError } = await window.sb
                    .from('requests')
                    .select('*', { count: 'exact', head: true })
                    .eq('status', 'pending');

                if (reqError) throw reqError;
                document.getElementById('pendingRequests').innerText = requestCount || 0;

                window.toast.success('Dashboard loaded successfully');
            } catch (error) {
                console.error('Error loading stats:', error);
                window.toast.error('Failed to load some statistics');
            }
        });
    </script>
</body>

</html>