<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - LearnHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="bg-light d-flex align-items-center justify-content-center" style="min-height: 100vh;">

    <div class="card shadow-lg border-0" style="width: 100%; max-width: 400px;">
        <div class="card-body p-5">
            <h3 class="text-center fw-bold mb-4 text-primary">Admin Login</h3>
            <form id="adminLoginForm">
                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="adminEmail" required>
                </div>
                <div class="mb-4">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="adminPassword" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">Login</button>
            </form>
            <div id="loginError" class="alert alert-danger mt-3 d-none"></div>
        </div>
    </div>

    <script src="../assets/js/supabase-client.js"></script>
    <script>
        document.getElementById('adminLoginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('loginError');

            try {
                // Simple plain text password check
                const { data: user, error: userError } = await window.sb
                    .from('users')
                    .select('*')
                    .eq('email', email)
                    .eq('password', password)
                    .eq('role', 'admin')
                    .single();

                if (userError || !user) {
                    errorDiv.textContent = 'Invalid admin credentials.';
                    errorDiv.classList.remove('d-none');
                } else {
                    // Save session (without password)
                    const { password: _, ...userWithoutPassword } = user;
                    localStorage.setItem('adminUser', JSON.stringify(userWithoutPassword));
                    window.location.href = 'dashboard.html';
                }
            } catch (err) {
                console.error('Admin login error:', err);
                errorDiv.textContent = 'An error occurred. Please try again.';
                errorDiv.classList.remove('d-none');
            }
        });
    </script>
</body>

</html>